# Загрузка системы
## Задание:
1. Включить отображение меню Grub.
2. Попасть в систему без пароля несколькими способами.
3. Установить систему с LVM, после чего переименовать VG

## Включить отображение меню Grub
 - По умолчанию меню загрузчика Grub скрыто и нет задержки при загрузке. Для отображения меню нужно отредактировать конфигурационный файл.
```
nano /etc/default/grub
```

 - Комментируем строку, скрывающую меню и ставим задержку для выбора пункта меню в 10 секунд.
```
#GRUB_TIMEOUT_STYLE=hidden
GRUB_TIMEOUT=10
```
 - Обновляем конфигурацию загрузчика и перезагружаемся для проверки.
```
root@ubuntu22:~# update-grub
root@ubuntu22:~# reboot
```
## Попасть в систему без пароля несколькими способами.

 - При загрузке в окне виртуальной машины мы должны увидеть меню загрузчика. Для того что бы редактировать параметры системы нажимаем "E"
 - В конце строки, начинающейся с linux удаляем все что до ro, добавляем init=/bin/bash, ro меняем на rw и нажимаем сtrl-x для загрузки в систему
 - для того что бы сменить пароль пользователю пишем:
```
echo "user1:password123" | sudo chpasswd
```
 - перезагружаем машину

## Установить систему с LVM, после чего переименовать VG

 - Мы установили систему Ubuntu 22.04 со стандартной разбивкой диска с использованием  LVM.
 - Первым делом посмотрим текущее состояние системы (список Volume Group):
```
vgs
  VG        #PV #LV #SN Attr   VSize  VFree
  ubuntu-vg   1   1   0 wz--n- 18.22g 8.22g
```
 - Нас интересует вторая строка с именем Volume Group. Приступим к переименованию:
```
root@ubuntu22:~# vgrename ubuntu-vg vgnew
Volume group "ubuntu-vg" successfully renamed to "vgnew"
```
Далее правим /boot/grub/grub.cfg. Везде заменяем старое название VG на новое.
После чего можем перезагружаться и, если все сделано правильно, успешно грузимся с новым именем Volume Group и проверяем:
```
vgs
  VG        #PV #LV #SN Attr   VSize  VFree
  vgnew   1   1   0 wz--n- 18.22g 8.22g
```
### Работа с initramfs

 - если перезагрузится без изменения /boot/grub/grub.cfg то система сломается и загрузится в initramfs
 - для востановления системы делаем следующие:
1. монтируем /dev/vgnew/ubuntu-lv в /mnt
   ```
   mount /dev/vgnew/ubuntu-lv /mnt
   ```
2. настраиваем обращение к файлам папок proc,sys,dev,run через новый корень /mnt(/mnt/proc/, etc) 
   ```
   for i in /proc/ /sys/ /dev/ /run/; \
   do mount --bind $i /mnt/$i; done
   ```
3. Меняем корневой каталог на /mnt
   ```
   chroot /mnt/
   ```
4. Обратно меняем название VG:
   ```
    vgrename vgnew ubuntu-vg
   ```
5. Перезагружаем машину

